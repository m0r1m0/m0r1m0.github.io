<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N6MC6SMGJM"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-N6MC6SMGJM', {
              page_path: window.location.pathname,
            });
          </script><link rel="alternate" type="application/rss+xml" title="RSS feed" href="/rss.xml"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ブランチ間の変更行数を出す</title><meta property="og:title" content="ブランチ間の変更行数を出す"/><meta property="og:description" content="ってググればでる。"/><meta name="twitter:card" content="summary"/><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/css/1e8ccdab538ecc583dd2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1e8ccdab538ecc583dd2.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8c35c68098dd8759f6c1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8c35c68098dd8759f6c1.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-1aebe1c5ebad78b6eefd.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.040a3874e38b7cc6b430.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5874fa266a7d44909009.js" as="script"/><link rel="preload" href="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.bb32f9c4396722e794d4.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/articles/%5Bid%5D-16081245fdd7df34b03c.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><h1 class="layout_title__24-9Z"><a href="/">🌳MORIMO🌳</a></h1></header><main><article class="detail_article__3SXso"><div><span>2021年03月06日</span><h1>ブランチ間の変更行数を出す</h1></div><div><p>ってググればでる。</p>
<pre><code class="hljs language-bash">git <span class="hljs-built_in">log</span> --numstat --pretty=<span class="hljs-string">"%H"</span> branch1..branch2  | awk <span class="hljs-string">'NF==3 {plus+=$1; minus+=$2} END {printf("+%d, -%d\n", plus, minus)}'</span></code></pre>
<p>参考：<a href="https://stackoverflow.com/questions/2528111/how-can-i-calculate-the-number-of-lines-changed-between-two-commits-in-git/2528129#2528129">How can I calculate the number of lines changed between two commits in Git?</a></p>
<p>ただ内容が理解できないし、理解できていないのはキモいので紐解く。</p>
<h2><code>--numstat</code></h2>
<blockquote>
<p>Similar to <code>--stat</code>, but shows number of added and deleted lines in decimal notation and pathname without abbreviation, to make it more machine friendly. For binary files, outputs two <code>-</code> instead of saying <code>0 0</code>.</p>
</blockquote>
<p><a href="https://git-scm.com/docs/git-log#Documentation/git-log.txt---numstat">--numstat｜https://git-scm.com</a></p>
<p><code>--stat</code>？</p>
<blockquote>
<p>Generate a diffstat.</p>
</blockquote>
<p><a href="https://git-scm.com/docs/git-log#Documentation/git-log.txt---numstat">--stat｜https://git-scm.com</a></p>
<p>diffstatはdiff結果から各ファイルの追加・削除行数をまとめて出してくれるやつぽい。</p>
<p>つまり、<code>—numstat</code>はそのdiffstatを<code>追加行数 削除行数 ファイルパス</code>形式で出力してくれる。</p>
<h2><code>--pretty</code></h2>
<p>コミットログをprettyで指定した形式で表示する。例えば、<code>%H</code> はコミットハッシュ。</p>
<p>つまり、<code>git log —numstat —pretty="%H"</code> は以下のような出力になる</p>
<pre><code class="hljs language-bash">f7cc64ff097f165df3ac457acac183f377acdc0c

16      0       package-lock.json
2       1       package.json
34      21      src/index.ts
e6490bc5ec9da0da9419acfc28186638e9ad6255

1       1       README.md</code></pre>
<p>で、次はパイプ以降何をしているのか見ていく。</p>
<h2><code>awk</code></h2>
<p>空白もしくは<code>-F</code>オプションで指定した正規表現にマッチする文字で区切られた文字列を処理するコマンド。
<a href="https://www.atmarkit.co.jp/ait/articles/1706/02/news017.html">【 awk 】コマンド（基本編）――テキストの加工とパターン処理を行う</a></p>
<p><code>パターン{アクション}</code>の形式で指定した処理をしていく。</p>
<p>例えば、<code>NF==3 {plus+=$1; minus+=$2}</code>のパターン<code>NF==3</code>は、空白で区切られた文字列の数が3つの行を指す。<code>—-numstat</code> は追加行数、削除行数、ファイルパスが空白で区切られてるので、一致する。つまり、追加行数、削除行数、ファイルパスの行で、plus、minusという変数に追加・削除行数を足し込む、という処理になる。</p>
<p>また、ENDは最終行のあと、というパターン。つまり、<code>END {printf("+%d, -%d\n", plus, minus)}</code>は最終行まで処理したあと、<code>"+%d, -%d\n"</code>形式でそれぞれ追加行数、削除行数を出力するという処理になる。</p>
<p>なるほど、たしかに<code>git log --numstat --pretty="%H" branch1..branch2  | awk 'NF==3 {plus+=$1; minus+=$2} END {printf("+%d, -%d\n", plus, minus)}'</code>がブランチ間の変更行数を出すことがわかった。</p>
<p>ただ、<code>--pretty</code>でわざわざ<code>%H</code>とする必要性はないように思う。コミットハッシュは最終的な出力に関係ないので。コミットに関する情報は消して、各ファイルの変更行数情報だけが出力されればおｋである。つまり、完成形としては、以下のようになる。</p>
<pre><code class="hljs language-bash">git <span class="hljs-built_in">log</span> --numstat --pretty=<span class="hljs-string">""</span> branch1..branch2  | awk <span class="hljs-string">'NF==3 {plus+=$1; minus+=$2} END {printf("+%d, -%d\n", plus, minus)}'</span></code></pre>
</div></article></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"date":"2021年03月06日","title":"ブランチ間の変更行数を出す","content":"\u003cp\u003eってググればでる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egit \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e --numstat --pretty=\u003cspan class=\"hljs-string\"\u003e\"%H\"\u003c/span\u003e branch1..branch2  | awk \u003cspan class=\"hljs-string\"\u003e'NF==3 {plus+=$1; minus+=$2} END {printf(\"+%d, -%d\\n\", plus, minus)}'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e参考：\u003ca href=\"https://stackoverflow.com/questions/2528111/how-can-i-calculate-the-number-of-lines-changed-between-two-commits-in-git/2528129#2528129\"\u003eHow can I calculate the number of lines changed between two commits in Git?\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eただ内容が理解できないし、理解できていないのはキモいので紐解く。\u003c/p\u003e\n\u003ch2\u003e\u003ccode\u003e--numstat\u003c/code\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSimilar to \u003ccode\u003e--stat\u003c/code\u003e, but shows number of added and deleted lines in decimal notation and pathname without abbreviation, to make it more machine friendly. For binary files, outputs two \u003ccode\u003e-\u003c/code\u003e instead of saying \u003ccode\u003e0 0\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://git-scm.com/docs/git-log#Documentation/git-log.txt---numstat\"\u003e--numstat｜https://git-scm.com\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e--stat\u003c/code\u003e？\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGenerate a diffstat.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ca href=\"https://git-scm.com/docs/git-log#Documentation/git-log.txt---numstat\"\u003e--stat｜https://git-scm.com\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ediffstatはdiff結果から各ファイルの追加・削除行数をまとめて出してくれるやつぽい。\u003c/p\u003e\n\u003cp\u003eつまり、\u003ccode\u003e—numstat\u003c/code\u003eはそのdiffstatを\u003ccode\u003e追加行数 削除行数 ファイルパス\u003c/code\u003e形式で出力してくれる。\u003c/p\u003e\n\u003ch2\u003e\u003ccode\u003e--pretty\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003eコミットログをprettyで指定した形式で表示する。例えば、\u003ccode\u003e%H\u003c/code\u003e はコミットハッシュ。\u003c/p\u003e\n\u003cp\u003eつまり、\u003ccode\u003egit log —numstat —pretty=\"%H\"\u003c/code\u003e は以下のような出力になる\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ef7cc64ff097f165df3ac457acac183f377acdc0c\n\n16      0       package-lock.json\n2       1       package.json\n34      21      src/index.ts\ne6490bc5ec9da0da9419acfc28186638e9ad6255\n\n1       1       README.md\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eで、次はパイプ以降何をしているのか見ていく。\u003c/p\u003e\n\u003ch2\u003e\u003ccode\u003eawk\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e空白もしくは\u003ccode\u003e-F\u003c/code\u003eオプションで指定した正規表現にマッチする文字で区切られた文字列を処理するコマンド。\n\u003ca href=\"https://www.atmarkit.co.jp/ait/articles/1706/02/news017.html\"\u003e【 awk 】コマンド（基本編）――テキストの加工とパターン処理を行う\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eパターン{アクション}\u003c/code\u003eの形式で指定した処理をしていく。\u003c/p\u003e\n\u003cp\u003e例えば、\u003ccode\u003eNF==3 {plus+=$1; minus+=$2}\u003c/code\u003eのパターン\u003ccode\u003eNF==3\u003c/code\u003eは、空白で区切られた文字列の数が3つの行を指す。\u003ccode\u003e—-numstat\u003c/code\u003e は追加行数、削除行数、ファイルパスが空白で区切られてるので、一致する。つまり、追加行数、削除行数、ファイルパスの行で、plus、minusという変数に追加・削除行数を足し込む、という処理になる。\u003c/p\u003e\n\u003cp\u003eまた、ENDは最終行のあと、というパターン。つまり、\u003ccode\u003eEND {printf(\"+%d, -%d\\n\", plus, minus)}\u003c/code\u003eは最終行まで処理したあと、\u003ccode\u003e\"+%d, -%d\\n\"\u003c/code\u003e形式でそれぞれ追加行数、削除行数を出力するという処理になる。\u003c/p\u003e\n\u003cp\u003eなるほど、たしかに\u003ccode\u003egit log --numstat --pretty=\"%H\" branch1..branch2  | awk 'NF==3 {plus+=$1; minus+=$2} END {printf(\"+%d, -%d\\n\", plus, minus)}'\u003c/code\u003eがブランチ間の変更行数を出すことがわかった。\u003c/p\u003e\n\u003cp\u003eただ、\u003ccode\u003e--pretty\u003c/code\u003eでわざわざ\u003ccode\u003e%H\u003c/code\u003eとする必要性はないように思う。コミットハッシュは最終的な出力に関係ないので。コミットに関する情報は消して、各ファイルの変更行数情報だけが出力されればおｋである。つまり、完成形としては、以下のようになる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egit \u003cspan class=\"hljs-built_in\"\u003elog\u003c/span\u003e --numstat --pretty=\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e branch1..branch2  | awk \u003cspan class=\"hljs-string\"\u003e'NF==3 {plus+=$1; minus+=$2} END {printf(\"+%d, -%d\\n\", plus, minus)}'\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n","ogp":{"title":"ブランチ間の変更行数を出す","description":"ってググればでる。"}},"__N_SSG":true},"page":"/articles/[id]","query":{"id":"2021-03-06-git-lines-changed"},"buildId":"xal_XozqYmAXaQxo-GALa","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/_next/static/chunks/main-1aebe1c5ebad78b6eefd.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/_next/static/chunks/commons.040a3874e38b7cc6b430.js" async=""></script><script src="/_next/static/chunks/pages/_app-5874fa266a7d44909009.js" async=""></script><script src="/_next/static/chunks/c5b568cee8545d966ddc8d89f9063461e084494a.bb32f9c4396722e794d4.js" async=""></script><script src="/_next/static/chunks/pages/articles/%5Bid%5D-16081245fdd7df34b03c.js" async=""></script><script src="/_next/static/xal_XozqYmAXaQxo-GALa/_buildManifest.js" async=""></script><script src="/_next/static/xal_XozqYmAXaQxo-GALa/_ssgManifest.js" async=""></script></body></html>