---
title: 閉包テーブル depthカラム
---

RDB で階層構造をあつかう 記事で書いた「閉包テーブル」で階層構造（経路）を列挙するとき、そのデータをもとに計算する必要がある。

depthカラムに階層における深さを保持しておくことで、この計算を不要にすることができる。

この記事では、以下の階層構造を例に考える。

![](https://i.imgur.com/S6a9mNB.jpg)

ある項目を与えると、それらがどういう階層関係にあるのかを取得することを目的にクエリを考える。

例えば、肉、ブタ、トリ、ウシ、パスタを与えると、上のズの左半分の関係が得られることを期待する。

項目、閉包テーブルはそれぞれ以下のようになる
| id | name   |
|----|--------|
| 1  | 肉     |
| 2  | ブタ   |
| 3  | トリ   |
| 4  | ウシ   |
| 5  | パスタ |
| 6  | きのこ |
| 7  | 魚     |
| 8  | 白身   |
| 9  | サケ   |
| 10 | タイ   |
| 11 | 赤身   |
| 12 | マグロ |

| ancestor | descendant | depth |
|----------|------------|-------|
| 1        | 1          | 0     |
| 1        | 2          | 1     |
| 1        | 3          | 1     |
| 1        | 4          | 1     |
| 2        | 2          | 0     |
| 3        | 3          | 0     |
| 4        | 4          | 0     |
| 5        | 5          | 0     |
| 6        | 6          | 0     |
| 7        | 7          | 0     |
| 7        | 8          | 1     |
| 7        | 9          | 2     |
| 7        | 10         | 2     |
| 7        | 11         | 1     |
| 7        | 12         | 2     |
| 8        | 8          | 0     |
| 8        | 9          | 1     |
| 8        | 10         | 1     |
| 9        | 9          | 0     |
| 10       | 10         | 0     |
| 11       | 11         | 0     |
| 11       | 12         | 1     |
| 12       | 12         | 0     |